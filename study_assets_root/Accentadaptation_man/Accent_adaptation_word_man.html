
<!DOCTYPE html>
<html>
  <head>
    <title>Word identification Study - Minimal Pairs</title>
    <script src="https://unpkg.com/jspsych@7.3.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.1"></script>
    <script src = "https://unpkg.com@jspsych/jsPsych.randomization.factorial(factors, repetitions, unpack)"></script>
    <script src = "https://unpkg.com@jspsych/jsPsych.randomization.sampleWithoutReplacement"></script>
    <script src = "https://unpkg.com/@jspsych/plugin-survey@0.2.1"></script>
    <script src = "https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.2"></script>
    <script src ="https://unpkg.com/@jspsych/plugin-survey-text"></script>
    <script src ="https://unpkg.com/@jspsych/plugin-html-slider-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.2"></script>
    <script src="custom-plugins-7/plugin-passage-highlight.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice"></script>
    <script src="jatos.js"></script>
    <link href="https://unpkg.com/jspsych@7.3.2/css/jspsych.css" rel="stylesheet" type="text/css" />
  <style>
  </style>
  </head>
  <body> </body>
  <script>

    //initialize jsPsych 
      var jsPsych = initJsPsych({
        experiment_width: 600,
        on_close: function() {
          jatos.submitResultData(jsPsych.data.get().csv());
          jatos.endStudy(false, "study closed early");
        },
        on_data_update: function() {
          jatos.submitResultData(jsPsych.data.get().csv());
        },
        on_finish: function() {
          jatos.submitResultData(jsPsych.data.get().csv());
          jatos.endStudy(true);
        }
      });

    //create timeline 
      var timeline = [];
      
    //This is the welcome message at the start of the experiment. The participant can press any key to continue
    var welcome = {
      type: jsPsychInstructions,
      pages: ['欢迎来到我们的英语单词识别任务。本次实验会持续将近一个半小时。请不要返回上一页或者刷新页面，否则实验会终止。如果你想开始阅读实验同意书，请点击Continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(welcome);

 /* consent form */
 var consent = {
   type: jsPsychSurvey,
   button_label_finish: "Continue",
   pages: [
    [
    { 
        type: 'html',
        prompt: '<p><strong>实验同意书 (1/3)</p><p>英语单词识别任务, 研究编号 #30001771</p>'
      },
      { 
        type: 'html',
        prompt: '<p><strong>谁在开展此次研究?</strong></p><p>主要研究者: Dr. Henny Yeung, 学生主管: Xizi Deng, 加拿大西门菲莎大学，语言学系 </p>'
      },
      {
        type: 'html',
        prompt: '<p><strong>为什么我们要开展此次研究？</strong></p><p>本项研究致力于探讨非英语母语者如何识别英语单词</p>'
      },
      {
        type: 'html',
        prompt: '<p><strong>你的参与是完全自愿的。</strong></p><p>你的参与是完全自愿的。你有权拒绝参与此次实验。如果你决定参与该实验，你还是可以在没有任何理由的情况下中途退出，并且对你的未来的教育或者职业发展不会有任何负面影响。在实验结果发表之前，你也有权要求撤回你的数据。</p>'
      },
      {
      type: 'html',
        prompt: '<p><strong>研究中会发生什么？</strong></p><p> 如果你选择参与此次研究，你讲会完成两个实验。第一个实验中，你会听到一系列录音，每条录音包含一个英语单词，你需要从屏幕上的两个选项中判断哪一个是你听到的单词，请点击你听到的单词。在第二个实验中，你会听到两个故事，故事的文本会在屏幕上显示，并且有一些关键词会被用绿色标记，如果这些绿色关键词在录音中被读错了，请点击它们。实验的最后你会完成一个很短的问卷调查。整个实验会持续大约90分钟。</p>'
      },
      {
      type: 'html',
       prompt:'<p><strong>参见本次实验有风险吗？</strong></p><p>我们不认为参加本次实验会对你造成任何损害。</p>'
      },
      {
          type: 'html',
        prompt:'<p><strong>参加本次实验有什么益处吗？</strong></p><p>我们也不认为参加本次实验对你有什么直接的影响，但是实验结果可以帮助我们认识人类语言。</p>'
      },
      {
          type: 'html',
        prompt:'<p><b>你参加本次实验会获得酬劳吗？</b></p><p>你会获得人民币100元的酬劳。如果中途退出，你将不会获得任何酬劳。</p>'
      },
      {
          type: 'html',
        prompt:'<p><b>你的隐私将如何被保护？</b></p><p>我们会尊重你的隐私。你的名字绝对不会和你的实验数据一起出现。所有收集的数据会被存储在一个位于加拿大的密码保护的服务器上。 我们会用特殊的ID标记你的个人识别信息，并且这些信息会和实验数据分开储存在服务器上，只有主要研究者和学生主管能够获得这些信息和数据。你的个人识别信息永远不会出现在任何实验报告里面，只有实验数据会被上传到在线的研究共享平台上，供不同大学的研究者进一步探讨分析，但是我们在共享实验数据的同时，会将的你的个人识别信息和实验数据分离，你的个人识别信息永远不会出现在任何在线共享平台上。</p>'
      },
      {
          type: 'html',
        prompt:'<p><b>你的数据会被保留多久？</b></p><p>我们会永久保留你的实验数据，但是如果实验结果没有发表，所有实验数据都会被及时销毁。你的个人识别信息会最多被我们保留七年。</p>'
      },
      {
          type: 'html',
        prompt: '<p><b>我们会怎么处理研究的结果？</b></p><p>本次研究的结果会被出版在学术期刊上或者在学术会议上被展示。如果你对最后的实验结果感兴趣，你可以联系学生主管：Xizi Deng, xizid@sfu.ca 询问之后的实验结果。</p>'
      },
      {
          type: 'html',
        prompt:'<p><b>如果对本次研究有任何意见你可以联系谁？</b></p><p>如果你对你作为被试享有的权利或者实验参与的体验有任何问题，请联系加拿大西门菲莎大学的学术研究道德办公室主任：dore@sfu.ca or 778-782-6593.'
       },
    ],
    [
    { 
        type: 'html',
        prompt: '<p><strong>实验同意书 (2/3)</p><p>英语单词识别任务, 研究编号 #30001771</p>'
      },
    {
            type: 'html',
        prompt:'<p><b>数据在未来的使用。</b></p><p>你的实验数据会被发表在学术期刊上。实验数据会被上传到在线共享数据库或者平台。个人识别信息（例如姓名，电子邮箱，微信）会和这些发布或者上传的实验数据分离，以确保个人信息的安全。 请选择是否同意你的实验数据在未来的使用。 </p>'
       },
       {
        type: 'multi-choice',
        prompt: ' ',
        options: ['yes', 'no'],
        required: true,
        name: "Future Use of Data"
       },

       {
          type: 'html',
        prompt:'<p><b>你是否愿意我们之后继续联系你？</b></p><p>西门菲莎大学语言学系有可能会想要在未来继续联系你，邀请你参加以后的其他实验。请选择我们是否以后能够继续联系你。</p>'
       },
       {
        type: 'multi-choice',
        prompt: ' ',
        options: ['yes', 'no'],
        required: true,
        name: "Future Contact"
       },
    ],
    [
    { 
        type: 'html',
        prompt: '<p><strong>实验同意书 (3/3)</p><p>英语单词识别任务, 研究编号 #30001771</p>'
      },
      {
        type: 'html',
        prompt: '<p><b>我怎样同意参与实验？</b></p><p>参与本次实验完全取决于你的个人意愿。你有权拒绝参与本次实验。如果你决定参与，你也可以选择在不提供任何理由的情况下中途退出，这不会对你未来的教育或者就业有任何不良影响。</p>'
    },
    {
        type: 'html',
        prompt: '请选择你是否同意参与本次实验。如果你选择不同意，你会被转至关闭浏览器的页面上。如果你希望中途退出，请联系学生主管的微信：evapossible. 同意之后，你的相关法律权益不会被剥夺。'
    },
    {
      type: 'multi-choice',
       prompt: ' ',
       options: ['yes', 'do not consent'],
      required: true,
      name: "consent"
      },
    ],
  ],
  on_finish: function (data) {
    consent = jsPsych.data.get().values()[1]['response']['consent'] == 'yes';
    if(consent == false){ 
     console.log("Did not consent, ending experiment.");
      jsPsych.endExperiment("感谢考虑参加我们的实验。你现在可以关闭浏览器然后退出实验。");
}
  }
    };
    timeline.push(consent)


    //This is the instructions page. The participant can press any key to continue
    var instructions= {
      type: jsPsychInstructions,
      pages: [
        '在本次实验中，你会听到许多条录音，每条录音里面包含一个英语单词。你需要判断屏幕上的两个英语单词中，哪一个是你听到的单词，请点击选择你听到的单词。接下来，你会进行三组练习，通过这三组练习，你可以感受一下实验节奏。请坐在一个安静的环境中，戴上耳机。如果你准备好了，请点击continue。'
    ],
      button_label_next:"Continue",
      show_clickable_nav: true,
      allow_backward: false,
    };
    timeline.push(instructions);

  //practice trial 1
    var practicetrial1 = {
        type: jsPsychAudioButtonResponse,
        stimulus: 'Audio/Words/PT1_pot.wav',
        choices: ['Thought','Pot'],
        prompt: "你听到的单词是哪一个? (Practice 1/3)</p>",
        response_allowed_while_playing: false,
        };
  timeline.push(practicetrial1)

//adjusting volume
    var volume = {
        type: jsPsychInstructions,
        pages: ['真棒! 你完成了第一组测试。如果刚才录音的音量太小或者太大，请现在相应地调整电脑的音量。如果准备好了，请点击continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(volume);

    //practice trial 2
    var practicetrial2 = {
        type: jsPsychAudioButtonResponse,
        stimulus: 'Audio/Words/PT2_pies.wav',
        choices: ['Pies','Thighs'],
        prompt: "你听到的单词是哪一个? (Practice 2/3)</p>",
        response_allowed_while_playing: false,
        };
    timeline.push(practicetrial2)

    //practice trial 3
    var practicetrial3 = {
        type: jsPsychAudioButtonResponse,
        stimulus: 'Audio/Words/PT3_cops.wav',
        choices: ['Caps','Cops'],
        prompt: "你听到的单词是哪一个? (Practice 3/3)</p>",
        response_allowed_while_playing: false,
        };
    timeline.push(practicetrial3)

    //transition
    var transition = {
        type: jsPsychInstructions,
        pages: ['真棒! 正式的实验现在开始。如果准备好了，请点击continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(transition);


   //This preloads all  stimuli so that the trials run smoothly
   var audiolist = ['Audio/Words/MT2_bet.wav', 'Audio/Words/MT2_bet2.wav', 'Audio/Words/MT2_bat.wav', 'Audio/Words/MT2_bat2.wav','Audio/Words/MT7_bet.wav', 'Audio/Words/MT7_bet2.wav', 'Audio/Words/MT7_bat.wav', 'Audio/Words/MT7_bat2.wav','Audio/Words/MT11_bet.wav', 'Audio/Words/MT11_bet2.wav', 'Audio/Words/MT11_bat.wav', 'Audio/Words/MT11_bat2.wav','Audio/Words/MT3_bet.wav', 'Audio/Words/MT3_bet2.wav', 'Audio/Words/MT3_bat.wav', 'Audio/Words/MT3_bat2.wav','Audio/Words/MT8_bet.wav', 'Audio/Words/MT8_bet2.wav', 'Audio/Words/MT8_bat.wav', 'Audio/Words/MT8_bat2.wav','Audio/Words/MT12_bet.wav', 'Audio/Words/MT12_bet2.wav', 'Audio/Words/MT12_bat.wav', 'Audio/Words/MT12_bat2.wav','Audio/Words/ET1_bet.wav', 'Audio/Words/ET1_bet2.wav', 'Audio/Words/ET1_bat.wav', 'Audio/Words/ET1_bat2.wav','Audio/Words/ET2_bet.wav', 'Audio/Words/ET2_bet2.wav', 'Audio/Words/ET2_bat.wav', 'Audio/Words/ET2_bat2.wav','Audio/Words/ET3_bet.wav', 'Audio/Words/ET3_bet2.wav', 'Audio/Words/ET3_bat.wav', 'Audio/Words/ET3_bat2.wav','Audio/Words/ET4_bet.wav', 'Audio/Words/ET4_bet2.wav', 'Audio/Words/ET4_bat.wav', 'Audio/Words/ET4_bat2.wav','Audio/Words/ET5_bet.wav', 'Audio/Words/ET5_bet2.wav', 'Audio/Words/ET5_bat.wav', 'Audio/Words/ET5_bat2.wav','Audio/Words/ET6_bet.wav', 'Audio/Words/ET6_bet2.wav', 'Audio/Words/ET6_bat.wav', 'Audio/Words/ET6_bat2.wav','Audio/Words/MT2_bed.wav', 'Audio/Words/MT2_bed2.wav', 'Audio/Words/MT2_bad.wav', 'Audio/Words/MT2_bad2.wav','Audio/Words/MT7_bed.wav', 'Audio/Words/MT7_bed2.wav', 'Audio/Words/MT7_bad.wav', 'Audio/Words/MT7_bad2.wav','Audio/Words/MT11_bed.wav', 'Audio/Words/MT11_bed2.wav', 'Audio/Words/MT11_bad.wav', 'Audio/Words/MT11_bad2.wav','Audio/Words/MT3_bed.wav', 'Audio/Words/MT3_bed2.wav', 'Audio/Words/MT3_bad.wav', 'Audio/Words/MT3_bad2.wav','Audio/Words/MT8_bed.wav', 'Audio/Words/MT8_bed2.wav', 'Audio/Words/MT8_bad.wav', 'Audio/Words/MT8_bad2.wav','Audio/Words/MT12_bed.wav', 'Audio/Words/MT12_bed2.wav', 'Audio/Words/MT12_bad.wav', 'Audio/Words/MT12_bad2.wav','Audio/Words/ET1_bed.wav', 'Audio/Words/ET1_bed2.wav', 'Audio/Words/ET1_bad.wav', 'Audio/Words/ET1_bad2.wav','Audio/Words/ET2_bed.wav', 'Audio/Words/ET2_bed2.wav', 'Audio/Words/ET2_bad.wav', 'Audio/Words/ET2_bad2.wav','Audio/Words/ET3_bed.wav', 'Audio/Words/ET3_bed2.wav', 'Audio/Words/ET3_bad.wav', 'Audio/Words/ET3_bad2.wav','Audio/Words/ET4_bed.wav', 'Audio/Words/ET4_bed2.wav', 'Audio/Words/ET4_bad.wav', 'Audio/Words/ET4_bad2.wav','Audio/Words/ET5_bed.wav', 'Audio/Words/ET5_bed2.wav', 'Audio/Words/ET5_bad.wav', 'Audio/Words/ET5_bad2.wav','Audio/Words/ET6_bed.wav', 'Audio/Words/ET6_bed2.wav', 'Audio/Words/ET6_bad.wav', 'Audio/Words/ET6_bad2.wav','Audio/Words/MT2_ship.wav', 'Audio/Words/MT2_ship2.wav', 'Audio/Words/MT2_sheep.wav', 'Audio/Words/MT2_sheep2.wav','Audio/Words/MT7_ship.wav', 'Audio/Words/MT7_ship2.wav', 'Audio/Words/MT7_sheep.wav', 'Audio/Words/MT7_sheep2.wav','Audio/Words/MT11_ship.wav', 'Audio/Words/MT11_ship2.wav', 'Audio/Words/MT11_sheep.wav', 'Audio/Words/MT11_sheep2.wav','Audio/Words/MT3_ship.wav', 'Audio/Words/MT3_ship2.wav', 'Audio/Words/MT3_sheep.wav', 'Audio/Words/MT3_sheep2.wav','Audio/Words/MT8_ship.wav', 'Audio/Words/MT8_ship2.wav', 'Audio/Words/MT8_sheep.wav', 'Audio/Words/MT8_sheep2.wav','Audio/Words/MT12_ship.wav', 'Audio/Words/MT12_ship2.wav', 'Audio/Words/MT12_sheep.wav', 'Audio/Words/MT12_sheep2.wav','Audio/Words/ET1_ship.wav', 'Audio/Words/ET1_ship2.wav', 'Audio/Words/ET1_sheep.wav', 'Audio/Words/ET1_sheep2.wav','Audio/Words/ET2_ship.wav', 'Audio/Words/ET2_ship2.wav', 'Audio/Words/ET2_sheep.wav', 'Audio/Words/ET2_sheep2.wav','Audio/Words/ET3_ship.wav', 'Audio/Words/ET3_ship2.wav', 'Audio/Words/ET3_sheep.wav', 'Audio/Words/ET3_sheep2.wav','Audio/Words/ET4_ship.wav', 'Audio/Words/ET4_ship2.wav', 'Audio/Words/ET4_sheep.wav', 'Audio/Words/ET4_sheep2.wav','Audio/Words/ET5_ship.wav', 'Audio/Words/ET5_ship2.wav', 'Audio/Words/ET5_sheep.wav', 'Audio/Words/ET5_sheep2.wav','Audio/Words/ET6_ship.wav', 'Audio/Words/ET6_ship2.wav', 'Audio/Words/ET6_sheep.wav', 'Audio/Words/ET6_sheep2.wav','Audio/Words/MT2_fill.wav', 'Audio/Words/MT2_fill2.wav', 'Audio/Words/MT2_feel.wav', 'Audio/Words/MT2_feel2.wav','Audio/Words/MT7_fill.wav', 'Audio/Words/MT7_fill2.wav', 'Audio/Words/MT7_feel.wav', 'Audio/Words/MT7_feel2.wav','Audio/Words/MT11_fill.wav', 'Audio/Words/MT11_fill2.wav', 'Audio/Words/MT11_feel.wav', 'Audio/Words/MT11_feel2.wav','Audio/Words/MT3_fill.wav', 'Audio/Words/MT3_fill2.wav', 'Audio/Words/MT3_feel.wav', 'Audio/Words/MT3_feel2.wav','Audio/Words/MT8_fill.wav', 'Audio/Words/MT8_fill2.wav', 'Audio/Words/MT8_feel.wav', 'Audio/Words/MT8_feel2.wav','Audio/Words/MT12_fill.wav', 'Audio/Words/MT12_fill2.wav', 'Audio/Words/MT12_feel.wav', 'Audio/Words/MT12_feel2.wav','Audio/Words/ET1_fill.wav', 'Audio/Words/ET1_fill2.wav', 'Audio/Words/ET1_feel.wav', 'Audio/Words/ET1_feel2.wav','Audio/Words/ET2_fill.wav', 'Audio/Words/ET2_fill2.wav', 'Audio/Words/ET2_feel.wav', 'Audio/Words/ET2_feel2.wav','Audio/Words/ET3_fill.wav', 'Audio/Words/ET3_fill2.wav', 'Audio/Words/ET3_feel.wav', 'Audio/Words/ET3_feel2.wav','Audio/Words/ET4_fill.wav', 'Audio/Words/ET4_fill2.wav', 'Audio/Words/ET4_feel.wav', 'Audio/Words/ET4_feel2.wav','Audio/Words/ET5_fill.wav', 'Audio/Words/ET5_fill2.wav', 'Audio/Words/ET5_feel.wav', 'Audio/Words/ET5_feel2.wav','Audio/Words/ET6_fill.wav', 'Audio/Words/ET6_fill2.wav', 'Audio/Words/ET6_feel.wav', 'Audio/Words/ET6_feel2.wav','Audio/Words/MT2_mouth.wav', 'Audio/Words/MT2_mouth2.wav', 'Audio/Words/MT2_mouse.wav', 'Audio/Words/MT2_mouse2.wav','Audio/Words/MT7_mouth.wav', 'Audio/Words/MT7_mouth2.wav', 'Audio/Words/MT7_mouse.wav', 'Audio/Words/MT7_mouse2.wav','Audio/Words/MT11_mouth.wav', 'Audio/Words/MT11_mouth2.wav', 'Audio/Words/MT11_mouse.wav', 'Audio/Words/MT11_mouse2.wav','Audio/Words/MT3_mouth.wav', 'Audio/Words/MT3_mouth2.wav', 'Audio/Words/MT3_mouse.wav', 'Audio/Words/MT3_mouse2.wav','Audio/Words/MT8_mouth.wav', 'Audio/Words/MT8_mouth2.wav', 'Audio/Words/MT8_mouse.wav', 'Audio/Words/MT8_mouse2.wav','Audio/Words/MT12_mouth.wav', 'Audio/Words/MT12_mouth2.wav', 'Audio/Words/MT12_mouse.wav', 'Audio/Words/MT12_mouse2.wav','Audio/Words/ET1_mouth.wav', 'Audio/Words/ET1_mouth2.wav', 'Audio/Words/ET1_mouse.wav', 'Audio/Words/ET1_mouse2.wav','Audio/Words/ET2_mouth.wav', 'Audio/Words/ET2_mouth2.wav', 'Audio/Words/ET2_mouse.wav', 'Audio/Words/ET2_mouse2.wav','Audio/Words/ET3_mouth.wav', 'Audio/Words/ET3_mouth2.wav', 'Audio/Words/ET3_mouse.wav', 'Audio/Words/ET3_mouse2.wav','Audio/Words/ET4_mouth.wav', 'Audio/Words/ET4_mouth2.wav', 'Audio/Words/ET4_mouse.wav', 'Audio/Words/ET4_mouse2.wav','Audio/Words/ET5_mouth.wav', 'Audio/Words/ET5_mouth2.wav', 'Audio/Words/ET5_mouse.wav', 'Audio/Words/ET5_mouse2.wav','Audio/Words/ET6_mouth.wav', 'Audio/Words/ET6_mouth2.wav', 'Audio/Words/ET6_mouse.wav', 'Audio/Words/ET6_mouse2.wav','Audio/Words/MT2_think.wav', 'Audio/Words/MT2_think2.wav', 'Audio/Words/MT2_sink.wav', 'Audio/Words/MT2_sink2.wav','Audio/Words/MT7_think.wav', 'Audio/Words/MT7_think2.wav', 'Audio/Words/MT7_sink.wav', 'Audio/Words/MT7_sink2.wav','Audio/Words/MT11_think.wav', 'Audio/Words/MT11_think2.wav', 'Audio/Words/MT11_sink.wav', 'Audio/Words/MT11_sink2.wav','Audio/Words/MT3_think.wav', 'Audio/Words/MT3_think2.wav', 'Audio/Words/MT3_sink.wav', 'Audio/Words/MT3_sink2.wav','Audio/Words/MT8_think.wav', 'Audio/Words/MT8_think2.wav', 'Audio/Words/MT8_sink.wav', 'Audio/Words/MT8_sink2.wav','Audio/Words/MT12_think.wav', 'Audio/Words/MT12_think2.wav', 'Audio/Words/MT12_sink.wav', 'Audio/Words/MT12_sink2.wav','Audio/Words/ET1_think.wav', 'Audio/Words/ET1_think2.wav', 'Audio/Words/ET1_sink.wav', 'Audio/Words/ET1_sink2.wav','Audio/Words/ET2_think.wav', 'Audio/Words/ET2_think2.wav', 'Audio/Words/ET2_sink.wav', 'Audio/Words/ET2_sink2.wav','Audio/Words/ET3_think.wav', 'Audio/Words/ET3_think2.wav', 'Audio/Words/ET3_sink.wav', 'Audio/Words/ET3_sink2.wav','Audio/Words/ET4_think.wav', 'Audio/Words/ET4_think2.wav', 'Audio/Words/ET4_sink.wav', 'Audio/Words/ET4_sink2.wav','Audio/Words/ET5_think.wav', 'Audio/Words/ET5_think2.wav', 'Audio/Words/ET5_sink.wav', 'Audio/Words/ET5_sink2.wav','Audio/Words/ET6_think.wav', 'Audio/Words/ET6_think2.wav', 'Audio/Words/ET6_sink.wav', 'Audio/Words/ET6_sink2.wav'];
   var newaudiolist = ['Audio/Proficiency/PT1_P.wav','Audio/Proficiency/PT2_P.wav','Audio/Proficiency/1.wav','Audio/Proficiency/2.wav','Audio/Proficiency/3.wav','Audio/Proficiency/4.wav','Audio/Proficiency/5.wav','Audio/Proficiency/6.wav','Audio/Proficiency/7.wav','Audio/Proficiency/8.wav','Audio/Proficiency/9.wav','Audio/Proficiency/10.wav','Audio/Proficiency/11.wav']
     
   //This shows a loading bar with the message "please wait" while the stimuli are preloading
    var preload= {
        type: jsPsychPreload,
        audio: audiolist, 
        show_progress_bar: true,
        message: '实验录音正在加载，请等待。',
        auto_update_progress_bar: true
    }
    timeline.push(preload);

    //This is the starting point of the experiment after all the audio have loaded
    var start = {
      type: jsPsychInstructions,
      pages: ['如果准备好了，请点击continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(start);

    //creating empty arrays for the timelines for blocks 1, 2, 3, and ingredients for them
    var pretrialstim = []; 

function whichtarget(wordpair, filename){
  var data = {};
  if(filename.indexOf(wordpair[0]) !== -1){
    data.target=wordpair[0];
    data.distractor=wordpair[1];
  } else if(filename.indexOf(wordpair[1]) !== -1){
    data.target = wordpair[1];
    data.distractor=wordpair[0];
  }
  return data;
}

//creating distractor, target, audio key/value pairs within trialstim
for(var i=0; i<audiolist.length; i++){
    var data = {};
    if(i<48){
      data = whichtarget(['bet','bat'], audiolist[i]);
    } else if(i<96){
      data = whichtarget(['bed','bad'], audiolist[i]);
    }else if(i<144){
      data = whichtarget(['sheep','ship'], audiolist[i]);
    }else if(i<192){
      data = whichtarget(['fill','feel'], audiolist[i]);
    }else if(i<240){
      data = whichtarget(['mouth','mouse'], audiolist[i]);
    }else if(i<288){
      data = whichtarget(['sink','think'], audiolist[i]);
    }else {console.log('unexpected index while making block stimuli: ' + i)}
    //stretch goal: data.speaker
    pretrialstim.push({audio: audiolist[i], target:data.target, distractor:data.distractor});
};

//make structured arrays depending on the target word (prep for 'choices')
var wordsbytarget = {};
//var alltargets = ['bet','bat','bed','bad','sheep','ship','fill','feel','mouth','mouse','sink','think'];
wordsbytarget.bet = pretrialstim.filter( function(el) {
  return el.target == 'bet'
});
wordsbytarget.bat = pretrialstim.filter( function(el) {
  return el.target == 'bat'
});
wordsbytarget.bed = pretrialstim.filter( function(el) {
  return el.target == 'bed'
});
wordsbytarget.bad = pretrialstim.filter( function(el) {
  return el.target == 'bad'
});
wordsbytarget.sheep = pretrialstim.filter( function(el) {
  return el.target == 'sheep'
});
wordsbytarget.ship = pretrialstim.filter( function(el) {
  return el.target == 'ship'
});
wordsbytarget.fill = pretrialstim.filter( function(el) {
  return el.target == 'fill'
});
wordsbytarget.feel = pretrialstim.filter( function(el) {
  return el.target == 'feel'
});
wordsbytarget.mouth = pretrialstim.filter( function(el) {
  return el.target == 'mouth'
});
wordsbytarget.mouse = pretrialstim.filter( function(el) {
  return el.target == 'mouse'
});
wordsbytarget.sink = pretrialstim.filter( function(el) {
  return el.target == 'sink'
});
wordsbytarget.think = pretrialstim.filter( function(el) {
  return el.target == 'think'
});

//final version of trialstim to be populated below
var trialstim = [];

//making it so that half of each word has "target" as the left choice, and half the right.
for(i=0;i<Object.keys(wordsbytarget).length;i++){
  //collect all the objects for the current word (e.g. "bet")
  var thesewords = wordsbytarget[Object.keys(wordsbytarget)[i]];
  //assign which ones will have the target word on the right
  var targetright = jsPsych.randomization.sampleWithoutReplacement(thesewords, 12);
  //find left ones by using remainder function below
  var targetleft = thesewords.filter( function( el ){
      return targetright.indexOf( el ) < 0;
    });
  //create "choices" for targetright and targetleft and push to final version of stim
  for(j=0;j<targetright.length;j++){
    targetright[j].choices = [targetright[j].distractor,targetright[j].target];
    trialstim.push(targetright[j]);
  };
  for(j=0;j<targetleft.length;j++){
    targetleft[j].choices = [targetleft[j].target,targetleft[j].distractor];
    trialstim.push(targetleft[j]);
  };
};

//in case we need to submit some artwork to the Louvre
  //wordsbytarget.bet[i].choices = [wordsbytarget.bet[i].target, wordsbytarget.bet[i].distractor]
  //wordsbytarget[Object.keys(wordsbytarget)[i]].choices = [wordsbytarget[Object.keys(wordsbytarget)[i]].target,wordsbytarget[Object.keys(wordsbytarget)[i]].distractor];

    //timeline variables: Each timeline is separated by block
    var firstblock = {
    timeline: [
        {
            type: jsPsychAudioButtonResponse,
            stimulus: jsPsych.timelineVariable ('audio'),
            trial_duration: null,
            choices: jsPsych.timelineVariable ('choices'),
            prompt: "你听到的单词是哪一个?",
            response_allowed_while_playing: false,
            button_html: '<button class="jspsych-btn" style=" display: inline-block; padding: 6px 12px; margin: 0px; font-size: 36px; font-weight: 400; font-family: "Open Sans", "Arial", sans-serif; cursor: pointer; line-height: 1.4; text-align: center; white-space: nowrap; vertical-align: middle; background-image: none; border: 1px solid transparent; border-radius: 4px; color: #333; background-color: #fff; border-color: #ccc">%choice%</button>'
        }],
    on_finish: function(data) {
      var choosables = jsPsych.timelineVariable('choices', true);
      var chosenone = choosables[jsPsych.data.getLastTrialData().trials[0].response];
      jsPsych.data.addDataToLastTrial({wordchosen: chosenone});
      jsPsych.data.addDataToLastTrial({correct: jsPsych.timelineVariable('audio', true).includes(chosenone)});
    },
    randomize_order: true,
    timeline_variables: trialstim
};
timeline.push(firstblock)

//This is the first break
var break1 = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '休息时间到！你有最多两分钟的休息时间。如果你想现在继续进行实验，请按空格键。',
    trial_duration: 120000 //2 minutes in ms
    };
timeline.push(break1);

 //timeline variables: Block 2 audio files
 var secondblock = {
    timeline: [
        {
            type: jsPsychAudioButtonResponse,
            stimulus: jsPsych.timelineVariable ('audio'),
            trial_duration: null,
            choices: jsPsych.timelineVariable ('choices'),
            prompt: "你听到的单词是哪一个? ",
            response_allowed_while_playing: false,
            button_html: '<button class="jspsych-btn" style=" display: inline-block; padding: 6px 12px; margin: 0px; font-size: 36px; font-weight: 400; font-family: "Open Sans", "Arial", sans-serif; cursor: pointer; line-height: 1.4; text-align: center; white-space: nowrap; vertical-align: middle; background-image: none; border: 1px solid transparent; border-radius: 4px; color: #333; background-color: #fff; border-color: #ccc">%choice%</button>'
        }],
    on_finish: function(data){
      var choosables = jsPsych.timelineVariable('choices', true);
      var chosenone = choosables[jsPsych.data.getLastTrialData().trials[0].response];
      jsPsych.data.addDataToLastTrial({wordchosen: chosenone});
      jsPsych.data.addDataToLastTrial({correct: jsPsych.timelineVariable('audio', true).includes(chosenone)});
    },
    randomize_order: true,
    timeline_variables: trialstim
};
timeline.push(secondblock)

//This is the second break
timeline.push(break1)

 //timeline variables: Block 3 audio files
 var thirdblock = {
    timeline: [
        {
            type: jsPsychAudioButtonResponse,
            stimulus: jsPsych.timelineVariable ('audio'),
            trial_duration: null,
            choices: jsPsych.timelineVariable ('choices'),
            prompt: "你听到的单词是哪一个?",
            response_allowed_while_playing: false,
            button_html: '<button class="jspsych-btn" style=" display: inline-block; padding: 6px 12px; margin: 0px; font-size: 36px; font-weight: 400; font-family: "Open Sans", "Arial", sans-serif; cursor: pointer; line-height: 1.4; text-align: center; white-space: nowrap; vertical-align: middle; background-image: none; border: 1px solid transparent; border-radius: 4px; color: #333; background-color: #fff; border-color: #ccc">%choice%</button>'
        }],
    on_finish: function(data){
      var choosables = jsPsych.timelineVariable('choices', true);
      var chosenone = choosables[jsPsych.data.getLastTrialData().trials[0].response];
      jsPsych.data.addDataToLastTrial({wordchosen: chosenone});
      jsPsych.data.addDataToLastTrial({correct: jsPsych.timelineVariable('audio', true).includes(chosenone)});
    },
    randomize_order: true,
    timeline_variables: trialstim
};
timeline.push(thirdblock)

//this is the third break
timeline.push(break1)

//timeline variables: Block 4 audio files
 var fourthblock = {
    timeline: [
        {
            type: jsPsychAudioButtonResponse,
            stimulus: jsPsych.timelineVariable ('audio'),
            trial_duration: null,
            choices: jsPsych.timelineVariable ('choices'),
            prompt: "你听到的单词是哪一个?",
            response_allowed_while_playing: false,
            button_html: '<button class="jspsych-btn" style=" display: inline-block; padding: 6px 12px; margin: 0px; font-size: 36px; font-weight: 400; font-family: "Open Sans", "Arial", sans-serif; cursor: pointer; line-height: 1.4; text-align: center; white-space: nowrap; vertical-align: middle; background-image: none; border: 1px solid transparent; border-radius: 4px; color: #333; background-color: #fff; border-color: #ccc">%choice%</button>'
        }],
    on_finish: function(data){
      var choosables = jsPsych.timelineVariable('choices', true);
      var chosenone = choosables[jsPsych.data.getLastTrialData().trials[0].response];
      jsPsych.data.addDataToLastTrial({wordchosen: chosenone});
      jsPsych.data.addDataToLastTrial({correct: jsPsych.timelineVariable('audio', true).includes(chosenone)});
    },
    randomize_order: true,
    timeline_variables: trialstim
};
timeline.push(fourthblock)

//This shows a loading bar with the message "please wait" while the stimuli are preloading
var preloadproficiency= {
    type: jsPsychPreload,
    audio: newaudiolist, 
    show_progress_bar: true,
    message: '实验录音正在加载，请等待。',
    auto_update_progress_bar: true
  }
timeline.push(preloadproficiency);

// Proficiency task
var instructions= {
      type: jsPsychInstructions,
      pages: [
        '欢迎进入第二个实验，在本次实验中，你将听到几段包含一个故事的录音。请仔细听，注意每页文本的段落中被绿色标记的关键词，然后判断每段录音中哪些被绿色标记的关键词读错了，如果你认为哪个关键词读错了，请点击它，然后该单词会变成红色，表明你的答案已经被记录下来。如果你认为没有单词读错，请不要点击任何单词，录音播放完毕后会自动跳到下一页。在正式开始任务之前，你将完成两组练习。当你准备好之后，请点击“continue”。'
    ],
      button_label_next:"Continue",
      show_clickable_nav: true,
      allow_backward: false,
    };
    timeline.push(instructions);

//practice trial 1
  var practicetrial3 = {
    type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND_p1',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/PT1_P.wav',
    test_length: 3, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>The apple #pies# were delicious.',
};
  timeline.push(practicetrial3)

  //feedback
    var feedback1 = {
        type: jsPsychInstructions,
        pages: ['正确答案是“pies”.如果准备好继续下一个练习，请点击continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(feedback1);

//practice trial 2
    var practicetrial4 = {
    type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND_p2',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/PT2_P.wav',
    test_length: 4, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>The #water# was boiling in the pot for a few hours',
};
  timeline.push(practicetrial4)

  //feedback
    var feedback2 = {
        type: jsPsychInstructions,
        pages: ['正确答案是"全部发音正确",所以不用点击任何单词.如果准备好开始正式的实验，请点击continue。'
    ],
    button_label_next: "Continue",
    show_clickable_nav: true,
    allow_backward:false,
    };
    timeline.push(feedback2);

  //paragraph 1
    var trial1 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND1',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/1.wav',
    test_length: 14, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>Mary is having a busy #week#. She is worried about her #three# year old son, Andrew, who is #sick#, so it was hard for her to keep #track# of her schedule.',
};
  timeline.push(trial1)  

  //paragraph 2
    var trial2 = {
        Type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND2',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/2.wav',
    test_length: 9, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>She almost forgot about the #dinner# tonight, even though she had written it down in red #pen# so she would remember.',
};
  timeline.push(trial2)  

//paragraph 3
    var trial3 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND3',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/3.wav',
    test_length: 8, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>She doesn’t want to go to the dinner, while Andrew is at home alone, but she knows it is important because it is her #friend’s# birthday.',
};
  timeline.push(trial3)  

  //paragraph 4
    var trial4 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND4',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/4.wav',
    test_length: 11, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>She put the gift #bag# for her friend by the door so she would remember to bring it when she #leaves#. The babysitter should arrive at their house #soon#.',
};
  timeline.push(trial4)  

  //paragraph 5
    var trial5 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND5',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/5.wav',
    test_length: 13, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>Mary feels Andrew’s #cheek#. He must have a #fever#, because it #felt# very warm. “Come on, Andrew. #Sit# on this chair. The doctor said you have to take this #pill# once a day.”',
};
  timeline.push(trial5)  

  //paragraph 6
    var trial6 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND6',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/6.wav',
    test_length: 18, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>Before Andrew could #refuse#, Mary had put the medicine in his #mouth#. Mary went to get a cloth from the #messy# drawer under the #sink#. She #wet# the cloth in cold water before putting it on Andrew’s hot #forehead# just as the #doorbell# rings.',
};
  timeline.push(trial6)  

  //paragraph 7
    var trial7 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND7',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/7.wav',
    test_length: 15, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>“Hi, Sophie, how are you?” says Mary as she opens the door to the #babysitter#.“I’m good, thanks, Mary. It’s been #raining# so I got some water and #dirt# on my shoes though. How’s Andrew?” asks Sophie.',
};
  timeline.push(trial7)  

  //paragraph 8
    var trial8 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND8',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/8.wav',
    test_length: 15, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>“He’s not #feeling# well so I’m worried about him. He’s #sleeping# right now in his #bed#,” says Mary.“Don’t worry, Mary. Andrew will be taken care of. He just needs some #rest#. I will make him #soup# when he wakes up,” says Sophie.',
};
  timeline.push(trial8)  

  //paragraph 9
    var trial9 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND9',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/9.wav',
    test_length: 14, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>Mary #throws# the car keys into her purse and then #waves# goodbye to Sophie as she leaves the house. She puts her #leather# purse into the trunk of her car. She drives away to get #gas# before going to dinner.',
};
  timeline.push(trial9) 

  //paragraph 10
    var trial10 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND10',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/10.wav',
    test_length: 17, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>She drives away to get pizza, and when she arrives at the #restaurant#, she is excited to see a large #green# sign on the window that says “Daniella’s Pizzeria.” She has heard that it is the #fourth# best Italian restaurant in the city, and that the pizza is also #cheap#.',
};
  timeline.push(trial10)   

  //paragraph 11
    var trial11 = {
        type: jsPsychPassageHighlight,
    trial_name: 'RPCV_FOR_MAND11',
    preamble: '<h2>哪个（些）单词读错了？</h2>',
    stimulus: 'Audio/Proficiency/11.wav',
    test_length: 13, //13 + 5 sec grace
    //default_correct: true,
    word_tag_char: '#',
    //allow_audio_control: false,
    text: '<p>The restaurant is beautiful, and the #first# thing Mary #sees# is a big photo of the city of Rome on the walls. Mary enjoys a wonderful #meal# eating good #food# and catching up with her friends.',
};
  timeline.push(trial11)  

//End of main part, introducing survey
var instructions1 = {
        type: jsPsychInstructions,
         pages: ['感谢你完成本次实验的主要部分！接下来是一个5分钟的问卷调查。完成问卷调查之后，本次实验将结束。'
     ],
         button_label_next: "Continue",
         show_clickable_nav: true,
        allow_backward:false,
        };
    timeline.push(instructions1);

    // adding identifying questions
   var survey = {
        type: jsPsychSurveyText,
        questions: [
          {prompt: '姓名', placeholder: '姓名', required: true, rows: 1, 
          name: "Name"},
          {prompt: '年龄', placeholder: '年龄', required: true, rows: 1,
          name: "Age"},
          {prompt: '性别', placeholder: '性别', required: true, rows: 1,
          name: "Gender"},
          {prompt: '微信号', placeholder: '微信号', required: true, rows: 1,
          name: "Wechat"},
        ]
     };
     timeline.push(survey) 

//adding in language questions
 var survey1 = {
     type: jsPsychSurveyHtmlForm,
      preamble: '<p>1.  请列出你从出生以来包括母语和外语在内，学习过的所有语言，以及每门语言的水平和学习时长。请在第一语言一栏详细写出你的母语方言（如有）。</p>',
       html: '<p style="text-align:centre"> 第一语言 <input name="第一语言" type="text" placeholder="某种方言（如有）, etc." required=true />, <select name="熟练程度1"> <option value="母语水平">母语水平</option> <option value="精通">精通</option> <option value="中级">中级</option> <option value="初学者">初学者</option></select>, 学习时长 <input name="学习时长" type="text" /></p>'+
       '<p style="text-align:centre"> 第二语言 <input name="第二语言" type="text" required=true />, <select name="熟练程度2"> <option value="母语水平">母语水平</option> <option value="精通">精通</option> <option value="中级">初学者</option> <option value="初学者">初学者</option></select>, 学习时长 <input name="学习时长" type="text" /></p>'+
       '<p style="text-align:centre"> Third language <input name="第三语言" type="text" />, <select name="熟练程度3"> <option value="母语者水平">母语者水平</option> <option value="精通">精通</option> <option value="中级">中级</option> <option value="初学者">初学者</option></select>, 学习时长 <input name="学习时长" type="text" /></p>'+
       '<p style="text-align:centre"> Fourth language <input name="第四语言" type="text" />, <select name="熟练程度3"> <option value="母语者水平">母语水平</option> <option value="精通">精通</option> <option value="中级">中级</option> <option value="初学者">初学者</option></select>, 学习时长 <input name="学习时长" type="text" /></p>',

       name: "Languages Spoken"
};
timeline.push(survey1)

var survey2 = {
     type: jsPsychSurveyHtmlForm,
      preamble: '<p>2.  请输入最近一次四、六级，专四、专八或者雅思托福的成绩 </p>',
       html: '<p style="text-align:centre"> Name of the test <input name="考试名称" type="text" placeholder="考试名称" required=true /></p>'+
       '<p style="text-align:centre"> Grade <input name="考试成绩" type="text" placeholder="分数" required=true /></p>',

       name: "English scores"
};

timeline.push(survey2)


var survey3 = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: "你如何评价自己的英语听力水平?", 
      name: 'English listening', 
      options: ['非常不熟练', '比较不熟练', '合格', '较好', '精通','母语者水平'], 
      required: true,
      horizontal: true
    }, 
    {
      prompt: "你如何评价自己的英语口语水平?", 
      name: 'English speaking', 
      options: ['非常不熟练', '比较不熟练', '合格', '较好', '精通','母语者水平'], 
      required: true,
      horizontal: true
    }
  ],
};
timeline.push(survey3)


    //Ending message
    var Goodbye = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "感谢你的参与。请将本页面拍下来，注意一定要包含完成页面以及电脑桌面上显示的完成时间，以便获取报酬。之后请按键盘上的任意键，页面上显示The study is finished之后可以退出浏览器，并结束实验。",
    };
    timeline.push(Goodbye)

jatos.onLoad(() => {
  jsPsych.run(timeline)
});
  </script>
  </html>
